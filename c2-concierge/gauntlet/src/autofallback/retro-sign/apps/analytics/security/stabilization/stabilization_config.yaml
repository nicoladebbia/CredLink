# Phase 16 - Adversarial Lab v1
# Stabilization Configuration

stabilization:
  # Stabilization duration (days)
  duration_days: 6
  
  # Success criteria
  success_criteria:
    consecutive_green_nights: 2
    minimum_success_rate: 95.0
    maximum_flaky_tests: 2
    crash_threshold: 0
  
  # Flaky test management
  flaky_tests:
    detection:
      # Number of runs to consider for flaky detection
      sample_size: 10
      # Failure rate threshold to mark as flaky (0.0-1.0)
      flaky_threshold: 0.3
      # Minimum absolute failures to consider
      min_failures: 2
      
    quarantine:
      # Auto-quarantine detected flaky tests
      auto_quarantine: true
      # Quarantine duration (days)
      quarantine_duration: 7
      # Review required before unquarantine
      review_required: true
      
    recovery:
      # Maximum retry attempts for flaky tests
      max_retries: 3
      # Backoff strategy: exponential, linear, fixed
      backoff_strategy: "exponential"
      # Base delay between retries (ms)
      base_delay_ms: 1000
      
  # Crash minimization
  crash_minimization:
    prevention:
      # Memory limits (MB)
      memory_limit_mb: 1024
      # Execution timeout (seconds)
      execution_timeout_s: 300
      # Stack depth limits
      max_stack_depth: 1000
      
    detection:
      # Monitor for memory leaks
      detect_memory_leaks: true
      # Monitor for infinite loops
      detect_infinite_loops: true
      # Monitor for stack overflow
      detect_stack_overflow: true
      
    recovery:
      # Automatic restart on crash
      auto_restart: true
      # Maximum restart attempts
      max_restarts: 3
      # Graceful shutdown timeout (ms)
      shutdown_timeout_ms: 5000
      
  # Quality metrics
  quality_metrics:
    reliability:
      # Test reliability score (0-100)
      target_reliability: 98.0
      # Minimum test coverage
      min_coverage_percent: 85.0
      
    performance:
      # Maximum regression in performance (%)
      max_performance_regression: 10.0
      # 95th percentile response time (ms)
      p95_response_time_ms: 1000
      
    security:
      # Security test coverage
      security_coverage_percent: 95.0
      # Vulnerability scan pass rate
      vulnerability_pass_rate: 100.0
      
  # Nightly runs
  nightly_runs:
    schedule: "0 2 * * *"  # 2 AM UTC daily
    parallel_jobs: 4
    timeout_minutes: 60
    retry_on_failure: true
    max_retries: 2
    
    # Run composition
    run_all_tests: true
    include_fuzzing: true
    include_chaos: true
    include_parity: true
    
  # Documentation
  documentation:
    auto_generate: true
    include_metrics: true
    include_recommendations: true
    update_frequency: "daily"
    
    # Document sections
    sections:
      - "executive_summary"
      - "test_coverage_analysis"
      - "flaky_test_report"
      - "performance_trends"
      - "security_posture"
      - "recommendations"
      - "next_steps"

# Monitoring and alerting
monitoring:
  alerts:
    # Alert conditions
    conditions:
      - metric: "success_rate"
        operator: "lt"
        threshold: 90.0
        severity: "warning"
      - metric: "crash_count"
        operator: "gt"
        threshold: 0
        severity: "critical"
      - metric: "flaky_test_count"
        operator: "gt"
        threshold: 5
        severity: "warning"
        
    # Notification channels
    channels:
      - type: "email"
        recipients: ["security-team@example.com"]
      - type: "slack"
        webhook_url: "${SLACK_WEBHOOK_URL}"
        
# Reporting
reporting:
  artifacts_dir: "artifacts"
  retention_days: 30
  
  reports:
    daily:
      - "stabilization_summary.json"
      - "flaky_test_analysis.json"
      - "performance_metrics.json"
      
    weekly:
      - "stabilization_trends.json"
      - "quality_gates_status.json"
      - "recommendations_report.json"
      
    final:
      - "stabilization_completion_report.json"
      - "security_assessment.json"
      - "production_readiness.json"

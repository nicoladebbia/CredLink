# Phase 16 - Adversarial Lab v1
# Chaos Engineering Configuration

chaos:
  # Chaos experiment duration (seconds)
  experiment_duration: 120
  
  # Recovery timeout (seconds)  
  recovery_timeout: 60
  
  # Failure injection probability (0.0-1.0)
  failure_probability: 0.3
  
  # Chaos scenarios
  scenarios:
    tsa_down:
      description: "Timestamp Authority unavailable"
      enabled: true
      failure_type: "network_timeout"
      target_service: "tsa_service"
      expected_policy: "DEGRADED"
      expected_incident: true
      
    origin_5xx:
      description: "Origin server returns 5xx errors"
      enabled: true
      failure_type: "http_error"
      target_service: "origin_service"
      error_codes: [500, 502, 503, 504]
      expected_policy: "BLOCKED"
      expected_incident: true
      
    stale_version:
      description: "Stale manifest version detected"
      enabled: true
      failure_type: "version_mismatch"
      target_service: "version_checker"
      version_skew_days: 30
      expected_policy: "DEGRADED"
      expected_incident: true
      
    network_latency:
      description: "High network latency"
      enabled: false
      failure_type: "latency_spike"
      target_service: "all_services"
      latency_ms: 5000
      expected_policy: "DEGRADED"
      expected_incident: false
      
    memory_pressure:
      description: "Memory exhaustion"
      enabled: false
      failure_type: "resource_exhaustion"
      target_service: "verification_service"
      memory_usage_mb: 1024
      expected_policy: "BLOCKED"
      expected_incident: true

monitoring:
  # Metrics to monitor during chaos
  metrics:
    - name: "verification_latency"
      threshold_ms: 5000
    - name: "error_rate"
      threshold_percent: 50
    - name: "memory_usage"
      threshold_mb: 512
    - name: "cpu_usage"
      threshold_percent: 80
      
  # Health check endpoints
  health_checks:
    - endpoint: "/health"
      expected_status: 200
    - endpoint: "/verify/health"
      expected_status: 200
    - endpoint: "/tsa/health"
      expected_status: 200

safety:
  # Automatic rollback conditions
  rollback_conditions:
    - metric: "error_rate"
      threshold: 90
      duration_seconds: 30
    - metric: "memory_usage"
      threshold: 2048
      duration_seconds: 60
      
  # Emergency stop conditions
  emergency_stop:
    - metric: "cpu_usage"
      threshold: 95
    - metric: "disk_usage"
      threshold: 90

reporting:
  # Chaos experiment reporting
  artifacts_dir: "artifacts"
  reports:
    - "chaos_summary.json"
    - "failure_injection.log"
    - "recovery_timeline.json"
    - "performance_impact.csv"

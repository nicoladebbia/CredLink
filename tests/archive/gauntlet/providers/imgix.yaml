provider: imgix
name: "Imgix"
products: ["Image Optimization"]
base_url: "https://imgix.survival.test"
documentation:
  main: "https://docs.imgix.com/"
  metadata: "https://docs.imgix.com/apis/url/format/metadata"
last_updated: "2025-10-30"
notes: |
  Imgix behavior (as of 2025-10-30):
  
  • Default behavior strips all image metadata
  • auto=compress and auto=format aggressively remove metadata
  • No built-in Content Credentials preservation
  • Derived outputs (transforms) always strip metadata
  • Original images may preserve some metadata
  • JSON metadata endpoint available for debugging
  
  References:
  - https://docs.imgix.com/apis/url/format/auto#param-auto_compress_format
  - https://docs.imgix.com/apis/url/format/metadata

routes:
  - id: preserve-embed
    description: "Attempt preservation with minimal transforms"
    url_pattern: "/{origin_path}?{transform_params}"
    default_params: {}
    transform_mappings:
      resize_1024:
        w: 1024
      q_75:
        q: 75
      format_webp:
        fm: "webp"
      format_avif:
        fm: "avif"
      crop_1x1_center:
        w: 1024
        h: 1024
        fit: "crop"
        crop: "center"
      progressive_jpeg:
        fm: "jpg"
        q: 75
      rotate_90:
        rot: 90
      sharpen:
        sharp: 10
      gamma:
        gamma: 1.2
        con: 1.1
      png_to_jpg:
        fm: "jpg"
        q: 75
      dpr_2:
        dpr: 2
      provider_auto_optimize:
        auto: "compress,format"
        q: 75
    special_config:
      expected_behavior:
        embed_survival: false
        remote_survival: true
        reason: "Imgix strips metadata on all transforms by design"
      caveats:
        - "Derived outputs always strip metadata"
        - "No Content Credentials preservation available"
        - "auto=compress/format are aggressive metadata strippers"

  - id: strip-happy
    description: "Aggressive optimization with auto=compress,format"
    url_pattern: "/{origin_path}?{transform_params}"
    default_params:
      auto: "compress,format"
      q: 75
    transform_mappings:
      resize_1024:
        w: 1024
        auto: "compress,format"
      q_75:
        q: 75
        auto: "compress,format"
      format_webp:
        fm: "webp"
        auto: "compress,format"
      format_avif:
        fm: "avif"
        auto: "compress,format"
      crop_1x1_center:
        w: 1024
        h: 1024
        fit: "crop"
        crop: "center"
        auto: "compress,format"
      progressive_jpeg:
        fm: "jpg"
        auto: "compress,format"
      rotate_90:
        rot: 90
        auto: "compress,format"
      sharpen:
        sharp: 10
        auto: "compress,format"
      gamma:
        gamma: 1.2
        con: 1.1
        auto: "compress,format"
      png_to_jpg:
        fm: "jpg"
        auto: "compress,format"
      dpr_2:
        dpr: 2
        auto: "compress,format"
      provider_auto_optimize:
        auto: "compress,format"
        q: 75
    special_config:
      expected_behavior:
        embed_survival: false
        remote_survival: true
        reason: "auto=compress,format strips all metadata by default"

  - id: remote-only
    description: "Remote manifest only, embed ignored"
    url_pattern: "/{origin_path}?{transform_params}"
    default_params: {}
    transform_mappings:
      resize_1024:
        w: 1024
      q_75:
        q: 75
      format_webp:
        fm: "webp"
      format_avif:
        fm: "avif"
      crop_1x1_center:
        w: 1024
        h: 1024
        fit: "crop"
        crop: "center"
      progressive_jpeg:
        fm: "jpg"
        q: 75
      rotate_90:
        rot: 90
      sharpen:
        sharp: 10
      gamma:
        gamma: 1.2
        con: 1.1
      png_to_jpg:
        fm: "jpg"
        q: 75
      dpr_2:
        dpr: 2
      provider_auto_optimize:
        auto: "compress,format"
        q: 75
    special_config:
      edge_worker:
        inject_manifest_link: true
        fallback_html: true
      expected_behavior:
        embed_survival: false
        remote_survival: true
        reason: "Remote manifest injection via HTML fallback"

headers:
  test:
    User-Agent: "C2C-Gauntlet/1.0"
    Accept: "image/*,*/*;q=0.8"
  expected:
    Link: 'rel="c2pa-manifest"'
    Cache-Control: "public, max-age=31536000"
    ETag: "*"

probes:
  remote:
    method: "header_link"
    fallback: "html_link"
    verification: "hash_alignment"
  embed:
    method: "c2patool_verify"
    expected_on_routes: []
    failure_expected_on_routes: ["preserve-embed", "strip-happy", "remote-only"]
    notes:
      - "Imgix does not preserve embeds on transformed images"
      - "Only original images might retain some metadata"
      - "Content Credentials preservation not available"

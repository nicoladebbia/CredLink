# Controls Registry - Complete Mapping
# Maps SOC 2 TSC to NIST 800-53 to Platform Controls

metadata:
  system: "Phase 59 Content Credentials Platform"
  version: "1.0"
  last_updated: "2025-11-07"
  frameworks:
    - "AICPA TSC 2017"
    - "AICPA Description Criteria 2018"
    - "NIST SP 800-53 Rev. 5"

# Registry Structure:
# Each control maps TSC -> NIST -> Owner -> Policy -> Evidence

controls:
  # COMMON CRITERIA
  - control_id: "CC1.1"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "Control Environment"
    name: "Integrity and Ethical Values"
    description: "Organization demonstrates commitment to integrity and ethical values"
    nist_controls: ["AC-1", "PS-1"]
    owner: "Human Resources"
    policy_reference: "Code of Conduct v2.0"
    technical_implementation: "N/A - Organizational control"
    evidence_type:
      - "Policy documents"
      - "Training records"
      - "Signed acknowledgments"
    evidence_location: "hr/ethics-training/"
    testing_frequency: "Annual"
    last_tested: "2025-10-01"
    test_result: "Pass"
    
  - control_id: "CC6.1"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "Logical and Physical Access"
    name: "Logical Access Restrictions"
    description: "System restricts logical access through authentication and authorization"
    nist_controls: ["AC-2", "AC-3", "AC-6", "IA-2", "IA-4"]
    owner: "Security Team"
    policy_reference: "Access Control Policy v3.1"
    technical_implementation: "JWT authentication, RBAC, tenant isolation"
    code_reference:
      - "src/api-server.js#98-157"
      - "src/api-server.js#155-188"
    evidence_type:
      - "Authentication logs"
      - "Authorization test results"
      - "Code review"
    evidence_location: "logs/auth/", "tests/auth-tests.js"
    testing_frequency: "Continuous (automated)"
    last_tested: "2025-11-07"
    test_result: "Pass"
    
  - control_id: "CC6.2"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "Logical and Physical Access"
    name: "Account Management"
    description: "User access provisioned, modified, and terminated appropriately"
    nist_controls: ["AC-2", "IA-4"]
    owner: "IT / HR"
    policy_reference: "Account Management Procedures v2.3"
    technical_implementation: "Automated onboarding/offboarding, quarterly access reviews"
    evidence_type:
      - "Access provisioning tickets"
      - "Termination checklists"
      - "Access review reports"
    evidence_location: "hr/access-management/"
    testing_frequency: "Quarterly"
    last_tested: "2025-10-15"
    test_result: "Pass"
    
  - control_id: "CC6.3"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "Logical and Physical Access"
    name: "Authentication Credentials"
    description: "Authentication credentials managed and protected"
    nist_controls: ["IA-5"]
    owner: "Engineering / Security"
    policy_reference: "Password and Credentials Policy v2.0"
    technical_implementation: "Bcrypt password hashing, MFA enforcement, JWT secret validation"
    code_reference:
      - "src/index.js#9-39"
    evidence_type:
      - "Password policy configuration"
      - "MFA enrollment logs"
      - "JWT secret validation tests"
    evidence_location: "config/auth/", "tests/credential-tests.js"
    testing_frequency: "Continuous (automated)"
    last_tested: "2025-11-07"
    test_result: "Pass"
    
  - control_id: "CC6.6"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "Logical and Physical Access"
    name: "Encryption"
    description: "Data encrypted during transmission and at rest"
    nist_controls: ["SC-8", "SC-12", "SC-13", "SC-28"]
    owner: "Engineering / SRE"
    policy_reference: "Encryption Standards Policy v2.1"
    technical_implementation: "TLS 1.3, AES-256-GCM, CloudHSM FIPS 140-2 Level 3"
    code_reference:
      - "custody/custody-service.js"
    evidence_type:
      - "TLS configuration"
      - "Encryption key management logs"
      - "FIPS 140-2 certificates"
    evidence_location: "config/tls/", "kms/rotation-logs/"
    testing_frequency: "Monthly"
    last_tested: "2025-11-01"
    test_result: "Pass"
    
  - control_id: "CC6.7"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "Logical and Physical Access"
    name: "Transmission Control"
    description: "Transmission of information protected"
    nist_controls: ["SC-8"]
    owner: "SRE"
    policy_reference: "Network Security Policy v1.5"
    technical_implementation: "TLS 1.3 minimum, perfect forward secrecy, HSTS"
    evidence_type:
      - "SSL Labs scan results"
      - "TLS configuration"
    evidence_location: "security-scans/tls/"
    testing_frequency: "Monthly"
    last_tested: "2025-11-01"
    test_result: "Pass - A+ rating"
    
  - control_id: "CC7.1"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "System Operations"
    name: "Security Updates"
    description: "System vulnerabilities identified and remediated timely"
    nist_controls: ["SI-2", "SI-5"]
    owner: "Security Team"
    policy_reference: "Vulnerability Management Policy v2.0"
    technical_implementation: "Weekly scans, zero vulnerability policy, automated dependency updates"
    evidence_type:
      - "Vulnerability scan reports"
      - "Patch logs"
      - "npm audit results"
    evidence_location: "security/vuln-scans/", "dependencies/audit-logs/"
    testing_frequency: "Weekly"
    last_tested: "2025-11-06"
    test_result: "Pass - 0 vulnerabilities"
    
  - control_id: "CC7.2"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "System Operations"
    name: "System Monitoring"
    description: "System monitored to detect anomalies and security events"
    nist_controls: ["AU-2", "AU-3", "AU-6", "SI-4"]
    owner: "SRE / Security"
    policy_reference: "Monitoring and Logging Policy v1.8"
    technical_implementation: "Datadog SIEM, CloudWatch, anomaly detection, 24/7 alerting"
    code_reference:
      - "src/utils/logger.js"
    evidence_type:
      - "Monitoring dashboards"
      - "Alert configurations"
      - "Log samples"
    evidence_location: "monitoring/", "logs/"
    testing_frequency: "Continuous"
    last_tested: "2025-11-07"
    test_result: "Pass"
    
  - control_id: "CC7.3"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "System Operations"
    name: "Incident Response"
    description: "Security incidents identified, reported, and responded to timely"
    nist_controls: ["IR-2", "IR-4", "IR-5", "IR-6", "IR-8"]
    owner: "Security / SRE"
    policy_reference: "Incident Response Plan v4.0"
    technical_implementation: "PagerDuty 24/7, P1/P2/P3/P4 classification, runbooks, quarterly drills"
    evidence_type:
      - "Incident tickets"
      - "Post-mortems"
      - "Drill results"
    evidence_location: "incidents/", "post-mortems/", "drills/"
    testing_frequency: "Quarterly"
    last_tested: "2025-10-22"
    test_result: "Pass"
    
  - control_id: "CC7.4"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "System Operations"
    name: "Malicious Software Detection"
    description: "System protected against malicious software"
    nist_controls: ["SI-3"]
    owner: "Security / SRE"
    policy_reference: "Anti-Malware Policy v1.2"
    technical_implementation: "Endpoint protection, container scanning, immutable infrastructure"
    evidence_type:
      - "Endpoint protection logs"
      - "Container scan results"
    evidence_location: "security/endpoint-logs/", "security/container-scans/"
    testing_frequency: "Continuous"
    last_tested: "2025-11-07"
    test_result: "Pass"
    
  - control_id: "CC8.1"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "Change Management"
    name: "Change Management Controls"
    description: "Changes to system components authorized, designed, tested, and approved"
    nist_controls: ["CM-2", "CM-3", "CM-6"]
    owner: "Engineering Management"
    policy_reference: "Change Management Policy v3.0"
    technical_implementation: "GitOps, PR reviews, CAB approval, CI/CD testing gates"
    evidence_type:
      - "Pull requests with approvals"
      - "CAB meeting minutes"
      - "CI/CD logs"
    evidence_location: "github/", "change-management/", "ci-cd-logs/"
    testing_frequency: "Continuous (per change)"
    last_tested: "2025-11-07"
    test_result: "Pass"
    
  - control_id: "CC9.1"
    tsc_category: "CC - Common Criteria"
    tsc_principle: "Risk Mitigation"
    name: "Vendor Risk Management"
    description: "Risks from use of vendors identified and mitigated"
    nist_controls: ["SA-9"]
    owner: "Security / Procurement"
    policy_reference: "Third-Party Risk Management Policy v1.6"
    technical_implementation: "Vendor assessments, DPAs, SOC 2 reviews, 30-day sub-processor notice"
    evidence_type:
      - "Vendor assessments"
      - "DPA contracts"
      - "SOC 2 reports"
    evidence_location: "vendors/", "legal/dpas/"
    testing_frequency: "Annual per vendor"
    last_tested: "2025-09-15"
    test_result: "Pass"
    
  # AVAILABILITY CRITERIA
  - control_id: "A1.1"
    tsc_category: "A - Availability"
    tsc_principle: "Availability"
    name: "Environmental Protections"
    description: "Environmental protections and redundancy maintained"
    nist_controls: ["CP-6", "CP-7"]
    owner: "SRE"
    policy_reference: "Business Continuity Plan v2.5"
    technical_implementation: "Multi-AZ, multi-region (us-east-1, us-west-2), AWS physical controls"
    evidence_type:
      - "Architecture diagrams"
      - "AWS SOC 2 report"
      - "Multi-region configuration"
    evidence_location: "architecture/", "aws-compliance/"
    testing_frequency: "Quarterly"
    last_tested: "2025-10-30"
    test_result: "Pass"
    
  - control_id: "A1.2"
    tsc_category: "A - Availability"
    tsc_principle: "Availability"
    name: "Availability Monitoring"
    description: "System availability monitored and measured against objectives"
    nist_controls: ["SI-4", "CP-2"]
    owner: "SRE"
    policy_reference: "SLA/SLO Policy v1.3"
    technical_implementation: "Synthetic monitoring 60s intervals, SLO tracking (99.95%/99.9%), status page"
    evidence_type:
      - "Uptime reports"
      - "Monitoring dashboards"
      - "SLO compliance reports"
    evidence_location: "monitoring/uptime/", "slo-reports/"
    testing_frequency: "Continuous"
    last_tested: "2025-11-07"
    test_result: "Pass - SLO met"
    
  - control_id: "A1.3"
    tsc_category: "A - Availability"
    tsc_principle: "Availability"
    name: "Incident Response and Recovery"
    description: "Incidents affecting availability responded to and recovered from"
    nist_controls: ["IR-2", "IR-4", "IR-8", "CP-2", "CP-10"]
    owner: "SRE / Engineering Management"
    policy_reference: "Disaster Recovery Plan v3.0"
    technical_implementation: "RTO < 4hr, RPO < 15min, automated failover, quarterly DR drills"
    evidence_type:
      - "DR drill results"
      - "Failover test logs"
      - "RTO/RPO test reports"
    evidence_location: "dr/", "incident-response/"
    testing_frequency: "Quarterly"
    last_tested: "2025-10-22"
    test_result: "Pass - RTO/RPO met"

# Control Matrix Summary
control_summary:
  total_controls: 14
  by_category:
    Common_Criteria: 11
    Availability: 3
    Confidentiality: 0  # Future scope
    Processing_Integrity: 0  # Future scope
    Privacy: 0  # Future scope
    
  by_status:
    implemented: 14
    partially_implemented: 0
    planned: 0
    
  testing_coverage:
    continuous: 8
    monthly: 2
    quarterly: 3
    annual: 1
    
  recent_test_failures: 0
  open_findings: 0

# Evidence Collection Schedule
evidence_collection:
  continuous:
    - "Authentication logs"
    - "API access logs"
    - "Monitoring metrics"
    - "Vulnerability scans"
    - "CI/CD pipeline logs"
    
  daily:
    - "Backup verification"
    - "Security event logs"
    
  weekly:
    - "Dependency scans"
    - "Configuration compliance checks"
    
  monthly:
    - "Access reviews"
    - "TLS/SSL scans"
    - "Capacity reports"
    
  quarterly:
    - "DR drills"
    - "Policy reviews"
    - "Vendor assessments (rolling schedule)"
    - "Control self-assessments"
    
  annual:
    - "Penetration tests"
    - "SOC 2 audit"
    - "Risk assessments"
    - "Business impact analysis"

# Automated Evidence Sources
automated_evidence:
  logs:
    cloudwatch_logs:
      - "/aws/lambda/api-server"
      - "/aws/rds/postgresql"
      - "/aws/cloudtrail"
    datadog:
      - "Authentication events"
      - "API metrics"
      - "Infrastructure metrics"
      
  scans:
    snyk:
      frequency: "Daily"
      types: ["Dependencies", "Containers", "IaC"]
    npm_audit:
      frequency: "Pre-commit"
      policy: "Zero vulnerabilities"
      
  backups:
    rds:
      type: "Automated snapshots"
      frequency: "Continuous + Daily"
      retention: "35 days"
    s3:
      type: "Versioning + Replication"
      frequency: "Continuous"
      
  monitoring:
    uptime:
      provider: "Datadog Synthetics"
      frequency: "60 seconds"
      locations: 5
    performance:
      metrics: ["p50", "p95", "p99"]
      threshold_alerts: true

# Control Ownership Matrix
ownership:
  Security_Team:
    - "CC6.1"
    - "CC7.1"
    - "CC7.2"
    - "CC7.3"
    - "CC9.1"
    
  Engineering:
    - "CC6.1"
    - "CC6.3"
    - "CC6.6"
    - "CC8.1"
    
  SRE:
    - "CC6.6"
    - "CC6.7"
    - "CC7.2"
    - "CC7.3"
    - "CC7.4"
    - "A1.1"
    - "A1.2"
    - "A1.3"
    
  HR:
    - "CC1.1"
    - "CC6.2"
    
  IT:
    - "CC6.2"
    
  Engineering_Management:
    - "CC8.1"
    - "A1.3"

# Audit Trail
audit_history:
  - date: "2025-11-01"
    event: "SOC 2 Type I fieldwork completed"
    result: "Unqualified opinion - controls suitably designed"
    findings: 0
    observations: 2
    
  - date: "2025-10-22"
    event: "Quarterly DR drill"
    result: "Pass - RTO 3.2 hours, RPO 12 minutes"
    findings: 0
    
  - date: "2025-10-15"
    event: "Quarterly access review"
    result: "Pass - 100% accounts reviewed"
    findings: 0
    
  - date: "2025-09-30"
    event: "Annual penetration test"
    result: "Pass - 0 critical, 0 high, 3 medium (all remediated)"
    findings: 3
    
  - date: "2025-09-15"
    event: "Annual risk assessment"
    result: "Complete - risk register updated"
    findings: 0
